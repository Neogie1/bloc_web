{% extends "layout.html.twig" %}

{% block content %}
<div class="container my-5">

  {% if is_search and searchQuery %}
    <div class="alert alert-info mb-4">
      Résultats pour : <strong>"{{ searchQuery }}"</strong>
      <a href="/offres/list" class="float-end">Voir toutes les offres</a>
    </div>
  {% endif %}

  {% if offers|length > 0 %}
    <div class="row g-4">
      {% for offer in offers %}
        <div class="col-lg-4 col-md-6">
          <div class="job-description-box p-4 rounded-lg">
            <div class="job-content-box">
              <div class="job-inner-box">
                <div class="d-flex align-items-start">
                  <img
                    src="https://placehold.co/64x64"
                    alt="{{ offer.company }} logo"
                    class="w-12 h-12 rounded-lg object-contain bg-gray-50 me-3"
                    style="flex-shrink: 0; width: 64px; height: 64px;"
                  />
                  <div>
                    <h3 class="fw-semibold" style="font-size: 18px; color: #000000">
                      {{ offer.title }}
                    </h3>
                    <p class="text-primary font-medium" style="color: #8b5cf6 !important; font-weight: 500">
                      {{ offer.company }}
                    </p>
                    
                    <div style="display: flex; flex-direction: column;">
                      <!-- Localisation -->
                      <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin">
                          <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"></path>
                          <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        <span style="margin-left: 5px;">{{ offer.location }}</span>
                      </div>
                      
                      <!-- Date -->
                      <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar">
                          <path d="M8 2v4"></path>
                          <path d="M16 2v4"></path>
                          <rect width="18" height="18" x="3" y="4" rx="2"></rect>
                          <path d="M3 10h18"></path>
                        </svg>
                        <span style="margin-left: 5px;">Publiée le {{ offer.createdAt|date('d/m/Y') }}</span>
                      </div>
                      
                      <!-- Compétences -->
                      <div style="display: flex; align-items: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-badge">
                          <path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"/>
                        </svg>
                        <span style="margin-left: 5px;">{{ offer.skills }}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="mt-4 pt-4" style="border-top: 1px solid #e5e7eb;"></div>
            
            <div class="d-flex justify-content-center" style="margin-top: 10px;">
              <a href="#" class="btn btn-hover" 
                style="background-color: rgba(155, 135, 245, 0.1); color: #6b5cf6; width: 100%; font-weight: 500; padding: 0.5rem; border-radius: 0.375rem; display: flex; align-items: center; justify-content: center; text-decoration: none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send me-2" style="color: #6b5cf6;">
                  <path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"></path>
                  <path d="m21.854 2.147-10.94 10.939"></path>
                </svg>
                Postuler
              </a>
            </div>
          </div>
        </div>
        
        {# Clearfix pour le responsive #}
        {% if loop.index % 3 == 0 %}
          <div class="w-100 d-none d-lg-block"></div>
        {% endif %}
        {% if loop.index % 2 == 0 %}
          <div class="w-100 d-none d-md-block d-lg-none"></div>
        {% endif %}
      {% endfor %}
    </div>

    {# Pagination #}
    {% if total_pages > 1 %}
    <nav aria-label="Pagination" class="mt-5">
      <ul class="pagination justify-content-center">
        {% if current_page > 1 %}
          <li class="page-item">
            <a class="page-link" href="{% if is_search %}/offres/search?q={{ searchQuery }}&{% else %}/offres/list?{% endif %}page={{ current_page - 1 }}">
              &laquo; Précédent
            </a>
          </li>
        {% endif %}

        {% set start_page = max(1, current_page - 2) %}
        {% set end_page = min(total_pages, current_page + 2) %}

        {% if start_page > 1 %}
          <li class="page-item"><a class="page-link" href="{% if is_search %}/offres/search?q={{ searchQuery }}&{% else %}/offres/list?{% endif %}page=1">1</a></li>
          {% if start_page > 2 %}<li class="page-item disabled"><span class="page-link">...</span></li>{% endif %}
        {% endif %}

        {% for i in start_page..end_page %}
          <li class="page-item {% if i == current_page %}active{% endif %}">
            <a class="page-link" href="{% if is_search %}/offres/search?q={{ searchQuery }}&{% else %}/offres/list?{% endif %}page={{ i }}">
              {{ i }}
            </a>
          </li>
        {% endfor %}

        {% if end_page < total_pages %}
          {% if end_page < total_pages - 1 %}<li class="page-item disabled"><span class="page-link">...</span></li>{% endif %}
          <li class="page-item"><a class="page-link" href="{% if is_search %}/offres/search?q={{ searchQuery }}&{% else %}/offres/list?{% endif %}page={{ total_pages }}">{{ total_pages }}</a></li>
        {% endif %}

        {% if current_page < total_pages %}
          <li class="page-item">
            <a class="page-link" href="{% if is_search %}/offres/search?q={{ searchQuery }}&{% else %}/offres/list?{% endif %}page={{ current_page + 1 }}">
              Suivant &raquo;
            </a>
          </li>
        {% endif %}
      </ul>
      <div class="text-center text-muted mt-2">
        Page {{ current_page }} sur {{ total_pages }} - {{ total_offers }} offres trouvées
      </div>
    </nav>
    {% endif %}

  {% else %}
    <div class="alert alert-warning">
      Aucune offre disponible{% if is_search %} pour "{{ searchQuery }}"{% endif %}.
      {% if is_search %}<a href="/offres/list" class="alert-link">Voir toutes les offres</a>{% endif %}
    </div>
  {% endif %}
</div>
{% include 'footer.html.twig' %}
{% endblock %}