{% extends "layout.html.twig" %}

{% block stylesheets %}
{% endblock %}

{% block content %}
{{ parent() }}
    <link rel="stylesheet" href="/assets/style.css">
<div class="container-fluid">
    <div class="row">
        <div class="col-md-3">
            {% include 'admin/_menu.html.twig' %}
        </div>
        
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <h2><i class="bi bi-building me-2"></i> Créer une entreprise</h2>
                </div>
                
                <div class="card-body">
                    <form method="POST" action="{{ url_for('entreprises.create') }}" id="entrepriseForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom</label>
                                <input type="text" name="nom" class="form-control {% if errors.nom is defined %}is-invalid{% endif %}" 
                                       value="{{ old_input.nom|default('') }}" required>
                                {% if errors.nom is defined %}
                                    <div class="invalid-feedback">{{ errors.nom }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Secteur d'activité</label>
                                <input type="text" name="secteur" class="form-control {% if errors.secteur is defined %}is-invalid{% endif %}" 
                                       value="{{ old_input.secteur|default('') }}" required>
                                {% if errors.secteur is defined %}
                                    <div class="invalid-feedback">{{ errors.secteur }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Ville</label>
                                <input type="text" name="ville" class="form-control {% if errors.ville is defined %}is-invalid{% endif %}" 
                                       value="{{ old_input.ville|default('') }}" required>
                                {% if errors.ville is defined %}
                                    <div class="invalid-feedback">{{ errors.ville }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Pays</label>
                                <input type="text" name="pays" class="form-control {% if errors.pays is defined %}is-invalid{% endif %}" 
                                       value="{{ old_input.pays|default('') }}" required>
                                {% if errors.pays is defined %}
                                    <div class="invalid-feedback">{{ errors.pays }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea name="description" class="form-control {% if errors.description is defined %}is-invalid{% endif %}" 
                                      rows="4">{{ old_input.description|default('') }}</textarea>
                            {% if errors.description is defined %}
                                <div class="invalid-feedback">{{ errors.description }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Site web</label>
                            <div class="input-group">
                                <span class="input-group-text">https://</span>
                                <input type="text" name="site_web_part" class="form-control {% if errors.site_web is defined %}is-invalid{% endif %}" 
                                       value="{{ old_input.site_web|default('')|replace({'https://': ''}) }}"
                                       placeholder="www.exemple.com">
                                <input type="hidden" name="site_web" id="fullSiteWeb">
                            </div>
                            {% if errors.site_web is defined %}
                                <div class="invalid-feedback">{{ errors.site_web }}</div>
                            {% endif %}
                            <small class="form-text text-muted">Format: www.exemple.com</small>
                        </div>
                        
                        <div class="d-flex justify-content-end">
                            <a href="{{ url_for('entreprises.list') }}" class="btn btn-secondary me-2">Annuler</a>
                            <button type="submit" class="btn btn-primary">Enregistrer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('entrepriseForm');
    const siteWebInput = document.querySelector('input[name="site_web_part"]');
    const fullSiteWebInput = document.getElementById('fullSiteWeb');
    
    // Formatage avant soumission
    form.addEventListener('submit', function(e) {
        let value = siteWebInput.value.trim();
        if (value) {
            // Supprime tout protocole existant et reconstruit avec https://
            value = value.replace(/^(http:\/\/|https:\/\/)?/, '');
            fullSiteWebInput.value = 'https://' + value;
        } else {
            fullSiteWebInput.value = '';
        }
    });
    
    // Validation visuelle
    siteWebInput.addEventListener('blur', function() {
        let value = this.value.trim();
        if (value && !value.startsWith('www.')) {
            this.value = 'www.' + value;
        }
    });
});
</script>
{% endblock %}